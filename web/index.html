<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ChatGPT Archive</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.6.1/github-markdown.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css"
    />
    <style>
      :root {
        color-scheme: light dark;
        --header-offset: 72px;
      }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: Canvas;
        color: CanvasText;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 10;
        background: color-mix(in srgb, Canvas 92%, transparent);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid color-mix(in srgb, CanvasText 12%, transparent);
      }
      .bar {
        max-width: 1100px;
        margin: 0 auto;
        padding: 12px 16px;
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }
      .brand {
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .spacer {
        flex: 1;
      }
      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }
      input[type="text"] {
        width: min(520px, 70vw);
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid color-mix(in srgb, CanvasText 16%, transparent);
        background: Canvas;
        color: CanvasText;
      }
      button {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid color-mix(in srgb, CanvasText 16%, transparent);
        background: color-mix(in srgb, Canvas 90%, CanvasText 2%);
        color: CanvasText;
        cursor: pointer;
      }
      button:hover {
        background: color-mix(in srgb, Canvas 84%, CanvasText 4%);
      }
      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 20px 16px 56px;
      }
      /* Two-panel layout: search left, reader right. */
      .layout {
        display: grid;
        grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
        gap: 16px;
        align-items: start;
      }
      .status {
        margin: 12px 0 18px;
        font-size: 14px;
        color: color-mix(in srgb, CanvasText 70%, transparent);
      }
      .search-panel {
        padding: 16px;
        border-radius: 12px;
        border: 1px solid color-mix(in srgb, CanvasText 10%, transparent);
        background: color-mix(in srgb, Canvas 96%, CanvasText 1%);
        /* Keep search visible while scrolling the reader. */
        position: sticky;
        top: var(--header-offset);
        max-height: calc(100vh - var(--header-offset) - 32px);
        overflow: auto;
      }
      .search-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }
      .search-row input[type="text"] {
        flex: 1;
        min-width: 240px;
      }
      .filters {
        margin-top: 10px;
      }
      .filters summary {
        cursor: pointer;
        font-weight: 600;
      }
      .filters-grid {
        margin-top: 10px;
        display: grid;
        grid-template-columns: 110px 1fr;
        gap: 8px 12px;
        align-items: center;
      }
      .filters-grid label {
        font-size: 12px;
        color: color-mix(in srgb, CanvasText 70%, transparent);
      }
      .filters-grid select,
      .filters-grid input[type="number"],
      .filters-grid input[type="date"] {
        width: 100%;
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid color-mix(in srgb, CanvasText 16%, transparent);
        background: Canvas;
        color: CanvasText;
      }
      .results {
        margin-top: 12px;
        display: grid;
        gap: 10px;
      }
      .result {
        display: block;
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid color-mix(in srgb, CanvasText 10%, transparent);
        background: Canvas;
        cursor: pointer;
        text-align: left;
        font: inherit;
        color: inherit;
        appearance: none;
      }
      .result:hover {
        border-color: color-mix(in srgb, CanvasText 18%, transparent);
      }
      .result-title {
        font-weight: 600;
      }
      .result-meta {
        margin-top: 4px;
        font-size: 12px;
        color: color-mix(in srgb, CanvasText 65%, transparent);
      }
      .result-snippet {
        margin-top: 6px;
        font-size: 13px;
        line-height: 1.4;
        color: color-mix(in srgb, CanvasText 85%, transparent);
      }
      .result-snippet mark {
        padding: 0 2px;
        border-radius: 4px;
        background: color-mix(in srgb, CanvasText 20%, transparent);
        color: inherit;
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      .pill {
        display: inline-block;
        margin-left: 10px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid color-mix(in srgb, CanvasText 12%, transparent);
        font-size: 12px;
        color: color-mix(in srgb, CanvasText 70%, transparent);
      }
      .markdown-body {
        box-sizing: border-box;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid color-mix(in srgb, CanvasText 10%, transparent);
        background: Canvas;
      }
      .mermaid-diagram,
      .plantuml-diagram {
        margin: 16px 0;
      }
      .mermaid-diagram details,
      .plantuml-diagram details {
        margin-top: 10px;
      }
      @media (prefers-color-scheme: dark) {
        .markdown-body {
          border-color: color-mix(in srgb, CanvasText 14%, transparent);
        }
      }
      @media (max-width: 720px) {
        /* Stack panels on smaller screens. */
        .layout {
          grid-template-columns: 1fr;
        }
        .search-panel {
          position: static;
          max-height: none;
        }
        .markdown-body {
          padding: 16px;
        }
        input[type="text"] {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="bar">
        <div class="brand">ChatGPT Archive</div>
        <span id="current" class="pill">index.md</span>
        <div class="spacer"></div>
        <div class="controls">
          <input
            id="jump"
            type="text"
            placeholder="Open a file (e.g. 2025-11-20_My_Title.md)"
            autocomplete="off"
            spellcheck="false"
          />
          <button id="go" type="button">Open</button>
          <button id="home" type="button">Index</button>
          <button id="plantuml" type="button">PlantUML</button>
        </div>
      </div>
    </header>
    <main>
      <div class="layout">
        <section class="search-panel">
          <div class="search-row">
            <label class="sr-only" for="search">Search the archive</label>
            <input
              id="search"
              type="text"
              placeholder="Search chats (keyword + vector)"
              autocomplete="off"
              spellcheck="false"
            />
            <button id="search-btn" type="button">Search</button>
            <button id="search-clear" type="button">Clear</button>
          </div>
          <details class="filters">
            <summary>Filters</summary>
            <div class="filters-grid">
              <label for="search-mode">Mode</label>
              <select id="search-mode">
                <option value="hybrid" selected>Hybrid</option>
                <option value="keyword">Keyword</option>
                <option value="vector">Vector</option>
              </select>

              <label for="search-scope">Scope</label>
              <select id="search-scope">
                <option value="both" selected>Title + Body</option>
                <option value="content">Body only</option>
                <option value="title">Title only</option>
              </select>

              <label for="search-role">Role</label>
              <select id="search-role">
                <option value="" selected>Any</option>
                <option value="user">User</option>
                <option value="assistant">Assistant</option>
                <option value="system">System</option>
                <option value="tool">Tool</option>
              </select>

              <label for="search-sort">Sort</label>
              <select id="search-sort">
                <option value="relevance" selected>Relevance</option>
                <option value="newest">Newest</option>
              </select>

              <label for="search-limit">Limit</label>
              <input id="search-limit" type="number" min="5" max="50" value="20" />

              <label for="search-snippet">Snippet</label>
              <input id="search-snippet" type="number" min="6" max="40" value="12" />

              <label for="search-from">From</label>
              <input id="search-from" type="date" />

              <label for="search-to">To</label>
              <input id="search-to" type="date" />
            </div>
          </details>
          <div id="search-status" class="status" role="status" aria-live="polite"></div>
          <div id="results" class="results" role="list" aria-label="Search results"></div>
        </section>
        <section class="reader-panel">
          <div id="status" class="status"></div>
          <article id="content" class="markdown-body"></article>
        </section>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <script>
      const MARKDOWN_ROOT = "/markdown/";
      const PLANTUML_SERVER =
        localStorage.getItem("plantuml_server") || "https://www.plantuml.com/plantuml";

      const contentEl = document.getElementById("content");
      const statusEl = document.getElementById("status");
      const currentEl = document.getElementById("current");
      const jumpEl = document.getElementById("jump");
      const searchEl = document.getElementById("search");
      const searchStatusEl = document.getElementById("search-status");
      const resultsEl = document.getElementById("results");
      const modeEl = document.getElementById("search-mode");
      const scopeEl = document.getElementById("search-scope");
      const roleEl = document.getElementById("search-role");
      const sortEl = document.getElementById("search-sort");
      const limitEl = document.getElementById("search-limit");
      const snippetEl = document.getElementById("search-snippet");
      const fromEl = document.getElementById("search-from");
      const toEl = document.getElementById("search-to");
      const headerEl = document.querySelector("header");

      function setStatus(message) {
        statusEl.textContent = message || "";
      }

      function setSearchStatus(message) {
        searchStatusEl.textContent = message || "";
      }

      function updateHeaderOffset() {
        if (!headerEl) return;
        const height = Math.ceil(headerEl.getBoundingClientRect().height);
        const offset = height + 12;
        document.documentElement.style.setProperty("--header-offset", `${offset}px`);
      }

      function escapeHtml(value) {
        return String(value || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function highlightSnippet(snippet) {
        // Server uses [[...]] markers for FTS snippets.
        const escaped = escapeHtml(snippet);
        return escaped.replace(/\[\[/g, "<mark>").replace(/\]\]/g, "</mark>");
      }

      function isRelativeUrl(url) {
        return (
          url &&
          !url.startsWith("http://") &&
          !url.startsWith("https://") &&
          !url.startsWith("/") &&
          !url.startsWith("#")
        );
      }

      function sanitizeFileName(file) {
        if (!file) return null;
        const trimmed = String(file).trim();
        if (!trimmed || trimmed.includes("..") || trimmed.startsWith("/")) return null;
        return trimmed;
      }

      function getFileFromLocation() {
        const params = new URLSearchParams(window.location.search);
        return sanitizeFileName(params.get("file")) || "index.md";
      }

      function setFileInLocation(file, replace = false) {
        const url = new URL(window.location.href);
        url.searchParams.set("file", file);
        if (replace) {
          history.replaceState({ file }, "", url);
        } else {
          history.pushState({ file }, "", url);
        }
      }

      function rewriteRelativeUrls(root, currentFile) {
        const basePrefix = MARKDOWN_ROOT;
        root.querySelectorAll("img").forEach((img) => {
          const src = img.getAttribute("src");
          if (isRelativeUrl(src)) {
            img.setAttribute("src", basePrefix + src);
          }
        });

        root.querySelectorAll("a").forEach((a) => {
          const href = a.getAttribute("href");
          if (!isRelativeUrl(href)) return;

          if (href.toLowerCase().endsWith(".md")) {
            a.dataset.mdFile = href;
            a.setAttribute("href", "/?file=" + encodeURIComponent(href));
          } else {
            a.setAttribute("href", basePrefix + href);
          }
        });
      }

      function encode6bit(b) {
        if (b < 10) return String.fromCharCode(48 + b);
        b -= 10;
        if (b < 26) return String.fromCharCode(65 + b);
        b -= 26;
        if (b < 26) return String.fromCharCode(97 + b);
        b -= 26;
        if (b === 0) return "-";
        if (b === 1) return "_";
        return "?";
      }

      function append3bytes(b1, b2, b3) {
        const c1 = b1 >> 2;
        const c2 = ((b1 & 0x3) << 4) | (b2 >> 4);
        const c3 = ((b2 & 0xf) << 2) | (b3 >> 6);
        const c4 = b3 & 0x3f;
        return (
          "" +
          encode6bit(c1 & 0x3f) +
          encode6bit(c2 & 0x3f) +
          encode6bit(c3 & 0x3f) +
          encode6bit(c4 & 0x3f)
        );
      }

      function plantumlEncode(umlText) {
        if (!window.pako) return null;
        const bytes = new TextEncoder().encode(umlText);
        const compressed = window.pako.deflate(bytes, { level: 9 });

        let res = "";
        for (let i = 0; i < compressed.length; i += 3) {
          if (i + 2 === compressed.length) {
            res += append3bytes(compressed[i], compressed[i + 1], 0);
          } else if (i + 1 === compressed.length) {
            res += append3bytes(compressed[i], 0, 0);
          } else {
            res += append3bytes(compressed[i], compressed[i + 1], compressed[i + 2]);
          }
        }
        return res;
      }

      function ensurePlantumlWrapper(text) {
        let uml = String(text || "").trim();
        const startMatch = uml.match(/@start(\w+)/);
        if (!startMatch) {
          return "@startuml\n" + uml + "\n@enduml";
        }

        const kind = startMatch[1];
        const endRe = new RegExp("@end" + kind + "\\b");
        if (!endRe.test(uml)) {
          uml += "\n@end" + kind;
        }
        return uml;
      }

      function renderPlantuml(root) {
        const codeBlocks = Array.from(root.querySelectorAll("pre code"));
        for (const code of codeBlocks) {
          const className = code.className || "";
          const raw = code.textContent || "";
          const isPlantuml =
            className.includes("language-plantuml") ||
            className.includes("language-puml") ||
            className.includes("lang-plantuml") ||
            className.includes("lang-puml") ||
            /@start\w+/.test(raw);
          if (!isPlantuml) continue;

          const umlText = ensurePlantumlWrapper(raw);
          const encoded = plantumlEncode(umlText);
          if (!encoded) continue;

          // PlantUML servers support a "~1" prefix for this encoding variant.
          const imgUrl = `${PLANTUML_SERVER}/svg/~1${encoded}`;
          const pre = code.closest("pre");
          if (!pre) continue;

          const wrapper = document.createElement("div");
          wrapper.className = "plantuml-diagram";

          const img = document.createElement("img");
          img.loading = "lazy";
          img.alt = "PlantUML diagram";
          img.src = imgUrl;
          img.style.maxWidth = "100%";
          img.style.height = "auto";

          const imgBox = document.createElement("div");
          imgBox.style.overflowX = "auto";
          imgBox.appendChild(img);

          const details = document.createElement("details");
          const summary = document.createElement("summary");
          summary.textContent = "View PlantUML source";
          details.appendChild(summary);

          const sourcePre = document.createElement("pre");
          const sourceCode = document.createElement("code");
          sourceCode.className = "language-plantuml";
          sourceCode.textContent = raw.trim();
          sourcePre.appendChild(sourceCode);
          details.appendChild(sourcePre);

          wrapper.appendChild(imgBox);
          wrapper.appendChild(details);

          pre.replaceWith(wrapper);
        }
      }

      function getMermaidTheme() {
        return window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "default";
      }

      function initMermaid() {
        if (!window.mermaid) return false;
        if (window.__chatgptMermaidInitialized) return true;

        try {
          window.mermaid.initialize({
            startOnLoad: false,
            theme: getMermaidTheme(),
            securityLevel: "strict",
          });
          window.__chatgptMermaidInitialized = true;
          return true;
        } catch (e) {
          console.warn("Failed to initialize mermaid", e);
          return false;
        }
      }

      function renderMermaid(root) {
        if (!initMermaid()) return;

        const codeBlocks = Array.from(root.querySelectorAll("pre code"));
        let counter = 0;

        for (const code of codeBlocks) {
          const className = code.className || "";
          const raw = (code.textContent || "").trim();
          if (!raw) continue;

          const isMermaid =
            className.includes("language-mermaid") ||
            className.includes("lang-mermaid") ||
            /^(sequenceDiagram|flowchart|graph|stateDiagram|erDiagram|gantt|journey|mindmap|timeline)\b/m.test(
              raw
            );

          if (!isMermaid) continue;

          const pre = code.closest("pre");
          if (!pre) continue;

          const wrapper = document.createElement("div");
          wrapper.className = "mermaid-diagram";

          const svgBox = document.createElement("div");
          svgBox.style.overflowX = "auto";

          const svgContainer = document.createElement("div");
          svgContainer.style.maxWidth = "100%";
          svgBox.appendChild(svgContainer);

          const details = document.createElement("details");
          const summary = document.createElement("summary");
          summary.textContent = "View Mermaid source";
          details.appendChild(summary);

          const sourcePre = document.createElement("pre");
          const sourceCode = document.createElement("code");
          sourceCode.className = "language-mermaid";
          sourceCode.textContent = raw;
          sourcePre.appendChild(sourceCode);
          details.appendChild(sourcePre);

          wrapper.appendChild(svgBox);
          wrapper.appendChild(details);
          pre.replaceWith(wrapper);

          const id = `mermaid-${Date.now()}-${counter++}`;
          Promise.resolve(window.mermaid.render(id, raw))
            .then(({ svg, bindFunctions }) => {
              svgContainer.innerHTML = svg;
              if (typeof bindFunctions === "function") {
                bindFunctions(svgContainer);
              }

              const svgEl = svgContainer.querySelector("svg");
              if (svgEl) {
                svgEl.style.maxWidth = "100%";
                svgEl.style.height = "auto";
              }
            })
            .catch((err) => {
              console.warn("Failed to render Mermaid diagram", err);
              svgContainer.textContent = "Failed to render Mermaid diagram.";
              details.open = true;
            });
        }
      }

      function renderMarkdown(markdown, currentFile) {
        if (!window.marked) {
          contentEl.textContent =
            "Markdown renderer failed to load. Check your internet connection.";
          return;
        }

        marked.setOptions({
          gfm: true,
          breaks: false,
          mangle: false,
          headerIds: false,
        });

        const rawHtml = marked.parse(markdown);
        const cleanHtml =
          window.DOMPurify
            ? DOMPurify.sanitize(rawHtml, {
                ADD_TAGS: ["details", "summary"],
                ADD_ATTR: ["open"],
              })
            : rawHtml;

        contentEl.innerHTML = cleanHtml;
        renderMermaid(contentEl);
        renderPlantuml(contentEl);
        rewriteRelativeUrls(contentEl, currentFile);

        if (window.hljs) {
          contentEl.querySelectorAll("pre code").forEach((block) => {
            try {
              window.hljs.highlightElement(block);
            } catch {}
          });
        }
      }

      function clearResults() {
        resultsEl.textContent = "";
        setSearchStatus("");
      }

      function renderResults(items) {
        resultsEl.textContent = "";

        if (!items || items.length === 0) {
          setSearchStatus("No matches found.");
          return;
        }

        setSearchStatus(`Found ${items.length} result${items.length === 1 ? "" : "s"}.`);
        for (const item of items) {
          const card = document.createElement("button");
          card.className = "result";
          card.type = "button";
          card.dataset.file = item.file || "";
          card.setAttribute("role", "listitem");

          const title = document.createElement("div");
          title.className = "result-title";
          title.textContent = item.title || item.file || "Untitled";

          const meta = document.createElement("div");
          meta.className = "result-meta";
          const created = item.created ? `Created: ${item.created}` : "";
          const role = item.role ? `Role: ${item.role}` : "";
          const file = item.file ? `File: ${item.file}` : "";
          meta.textContent = [created, role, file].filter(Boolean).join(" • ");

          const snippet = document.createElement("div");
          snippet.className = "result-snippet";
          snippet.innerHTML = highlightSnippet(item.snippet || "");

          card.appendChild(title);
          card.appendChild(meta);
          card.appendChild(snippet);
          card.setAttribute("aria-label", `Open ${title.textContent}`);

          card.addEventListener("click", () => {
            if (item.file) {
              loadFile(item.file);
            }
          });

          resultsEl.appendChild(card);
        }
      }

      async function runSearch() {
        const query = (searchEl.value || "").trim();
        if (!query) return;

        setSearchStatus("Searching...");
        resultsEl.textContent = "";

        try {
          let mode = modeEl.value;
          const scope = scopeEl.value;
          const role = roleEl.value;
          const sort = sortEl.value;
          const limit = limitEl.value || "20";
          const snippet = snippetEl.value || "12";
          const from = fromEl.value;
          const to = toEl.value;

          if (scope === "title" && mode === "vector") {
            mode = "keyword";
          }

          const params = new URLSearchParams({
            q: query,
            limit,
            mode,
            scope,
            sort,
            snippet,
          });

          if (role) params.set("role", role);
          if (from) params.set("from", from);
          if (to) params.set("to", to);

          const res = await fetch(`/search?${params.toString()}`);
          const payload = await res.json();
          if (!res.ok || payload.error) {
            throw new Error(payload.error || `HTTP ${res.status}`);
          }
          renderResults(payload.results || []);
        } catch (err) {
          setSearchStatus(
            "Search failed. Make sure the converter ran and the search index exists."
          );
          console.error(err);
        }
      }

      async function loadFile(file, replaceState = false) {
        const safe = sanitizeFileName(file);
        if (!safe) {
          setStatus("Invalid file name.");
          return;
        }

        currentEl.textContent = safe;
        jumpEl.value = safe;
        setStatus("Loading…");
        setFileInLocation(safe, replaceState);

        const url = MARKDOWN_ROOT + safe;
        try {
          const res = await fetch(url);
          if (!res.ok) {
            throw new Error("HTTP " + res.status);
          }
          const text = await res.text();
          renderMarkdown(text, safe);
          setStatus("");
          document.title = safe === "index.md" ? "ChatGPT Archive" : safe;
        } catch (err) {
          setStatus(
            `Failed to load ${url}. Make sure you've run the converter and that markdown/index.md exists.`
          );
          contentEl.textContent = "";
          console.error(err);
        }
      }

      document.getElementById("home").addEventListener("click", () => {
        loadFile("index.md");
      });

      document.getElementById("plantuml").addEventListener("click", () => {
        const current =
          localStorage.getItem("plantuml_server") || "https://www.plantuml.com/plantuml";
        const next = window.prompt(
          "PlantUML server base URL (used for rendering diagrams). Leave blank to reset.",
          current
        );
        if (next === null) return;

        const trimmed = String(next).trim().replace(/\/+$/, "");
        if (!trimmed) {
          localStorage.removeItem("plantuml_server");
          window.location.reload();
          return;
        }

        if (!/^https?:\/\//i.test(trimmed)) {
          window.alert("Please enter a valid http(s) URL.");
          return;
        }

        localStorage.setItem("plantuml_server", trimmed);
        window.location.reload();
      });

      function openFromInput() {
        const value = sanitizeFileName(jumpEl.value);
        if (!value) return;
        loadFile(value);
      }

      document.getElementById("go").addEventListener("click", openFromInput);
      jumpEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") openFromInput();
      });

      document.getElementById("search-btn").addEventListener("click", runSearch);
      document.getElementById("search-clear").addEventListener("click", () => {
        searchEl.value = "";
        clearResults();
      });
      searchEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") runSearch();
      });

      contentEl.addEventListener("click", (e) => {
        const a = e.target.closest("a");
        if (!a) return;

        const mdFile = a.dataset.mdFile;
        if (mdFile) {
          e.preventDefault();
          loadFile(mdFile);
        }
      });

      window.addEventListener("popstate", () => {
        loadFile(getFileFromLocation(), true);
      });

      updateHeaderOffset();
      window.addEventListener("resize", updateHeaderOffset);
      loadFile(getFileFromLocation(), true);
    </script>
  </body>
</html>
